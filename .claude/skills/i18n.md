# Internationalization (i18n)

**Default language**: English (en) | **Secondary**: French (fr)

## Frontend Setup (next-intl)

```
apps/web/
├── messages/
│   ├── fr.json              # French translations 
│   └── en.json              # English translations (source of truth)
├── i18n/
│   ├── config.ts            # i18n configuration
│   ├── request.ts           # Server-side i18n
│   └── routing.ts           # Locale routing
└── app/
    └── [locale]/            # All pages under locale prefix
        ├── layout.tsx
        └── page.tsx
```

---

## Configuration

```typescript
// i18n/config.ts
export const locales = ['en', 'fr'] as const;
export const defaultLocale = 'en' as const;

export type Locale = (typeof locales)[number];
```

```typescript
// i18n/routing.ts
import { defineRouting } from 'next-intl/routing';
import { locales, defaultLocale } from './config';

export const routing = defineRouting({
  locales,
  defaultLocale,
  localePrefix: 'as-needed', // /about (en), /fr/about (fr)
});
```

```typescript
// i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

---

## Translation Files Structure

```json
// messages/fr.json 
{
  "common": {
    "loading": "Chargement...",
    "error": "Une erreur est survenue",
    "save": "Enregistrer",
    "cancel": "Annuler",
    "delete": "Supprimer",
    "edit": "Modifier",
    "search": "Rechercher",
    "noResults": "Aucun résultat"
  },
  "auth": {
    "login": "Connexion",
    "logout": "Déconnexion",
    "register": "Inscription",
    "forgotPassword": "Mot de passe oublié ?"
  },
  "validation": {
    "required": "Ce champ est requis",
    "email": "Email invalide",
    "minLength": "Minimum {min} caractères"
  },
  "features": {
    "title": "Fonctionnalités",
    "create": "Créer une fonctionnalité",
    "notFound": "Fonctionnalité introuvable"
  },
  "meta": {
    "home": {
      "title": "Accueil | MonApp",
      "description": "Description de la page d'accueil"
    }
  }
}
```

```json
// messages/en.json (SOURCE OF TRUTH)
{
  "common": {
    "loading": "Loading...",
    "error": "An error occurred",
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "search": "Search",
    "noResults": "No results"
  },
  "auth": {
    "login": "Login",
    "logout": "Logout",
    "register": "Sign up",
    "forgotPassword": "Forgot password?"
  },
  "validation": {
    "required": "This field is required",
    "email": "Invalid email",
    "minLength": "Minimum {min} characters"
  },
  "features": {
    "title": "Features",
    "create": "Create a feature",
    "notFound": "Feature not found"
  },
  "meta": {
    "home": {
      "title": "Home | Watu Care",
      "description": "Home page description"
    }
  }
}
```

---

## Component Usage

```typescript
// Server Component
import { getTranslations } from 'next-intl/server';

export default async function FeaturePage() {
  const t = await getTranslations('features');

  return <h1>{t('title')}</h1>;
}

// Client Component
'use client';
import { useTranslations } from 'next-intl';

export function FeatureCard() {
  const t = useTranslations('features');

  return <button>{t('create')}</button>;
}

// With interpolation
t('validation.minLength', { min: 8 }) // "Minimum 8 caractères"
```

---

## SEO Multilingue

```typescript
// app/[locale]/layout.tsx
import { getTranslations } from 'next-intl/server';
import { locales } from '@/i18n/config';

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { locale } = await params;
  const t = await getTranslations({ locale, namespace: 'meta.home' });

  return {
    title: t('title'),
    description: t('description'),
    alternates: {
      canonical: `https://domain.com/${locale === 'fr' ? '' : locale}`,
      languages: Object.fromEntries(
        locales.map((l) => [l, `https://domain.com/${l === 'fr' ? '' : l}`]),
      ),
    },
  };
}

export function generateStaticParams() {
  return locales.map((locale) => ({ locale }));
}
```

```typescript
// app/[locale]/layout.tsx - HTML lang attribute
export default function LocaleLayout({ children, params }: Props) {
  const { locale } = params;

  return (
    <html lang={locale}>
      <body>{children}</body>
    </html>
  );
}
```

---

## Language Switcher Component

```typescript
'use client';
import { useLocale } from 'next-intl';
import { usePathname, useRouter } from '@/i18n/routing';
import { locales, type Locale } from '@/i18n/config';

const localeLabels: Record<Locale, string> = {
  fr: 'Français',
  en: 'English',
};

export function LanguageSwitcher(): JSX.Element {
  const locale = useLocale();
  const pathname = usePathname();
  const router = useRouter();

  function handleChange(newLocale: Locale): void {
    router.replace(pathname, { locale: newLocale });
  }

  return (
    <select
      value={locale}
      onChange={(e) => handleChange(e.target.value as Locale)}
    >
      {locales.map((l) => (
        <option key={l} value={l}>{localeLabels[l]}</option>
      ))}
    </select>
  );
}
```

---

## Backend i18n (Error Messages)

```typescript
// common/i18n/translations.ts
const translations = {
  fr: {
    FEATURE_NOT_FOUND: 'Fonctionnalité introuvable',
    FEATURE_VALIDATION_ERROR: 'Erreur de validation',
    FEATURE_CONFLICT: 'Cette fonctionnalité existe déjà',
    UNAUTHORIZED: 'Non autorisé',
    INTERNAL_ERROR: 'Erreur interne du serveur',
  },
  en: {
    FEATURE_NOT_FOUND: 'Feature not found',
    FEATURE_VALIDATION_ERROR: 'Validation error',
    FEATURE_CONFLICT: 'This feature already exists',
    UNAUTHORIZED: 'Unauthorized',
    INTERNAL_ERROR: 'Internal server error',
  },
} as const;

type ErrorCode = keyof typeof translations.fr;
type Locale = keyof typeof translations;

export function getErrorMessage(code: ErrorCode, locale: Locale = 'fr'): string {
  return translations[locale][code] ?? translations.fr[code];
}
```

```typescript
// Usage in DomainError
export class FeatureNotFoundError extends DomainError {
  readonly code = 'FEATURE_NOT_FOUND';
  readonly statusCode = 404;

  constructor(id: string, locale: Locale = 'en') {
    super(getErrorMessage('FEATURE_NOT_FOUND', locale), { featureId: id });
  }
}

// In controller - get locale from Accept-Language header
@Get(':id')
async findOne(
  @Param('id') id: string,
  @Headers('accept-language') acceptLanguage?: string,
): Promise<FeatureResponseDto> {
  const locale = acceptLanguage?.startsWith('en') ? 'en' : 'fr';
  const result = await this.getFeature.execute(id, locale);
  // ...
}
```

---

## i18n Rules

1. **French is the source of truth** — always write fr.json first
2. **All user-facing strings must be translated** — no hardcoded text
3. **Use namespaces** — group by feature (common, auth, features, etc.)
4. **Interpolation over concatenation** — `{count} items` not `count + " items"`
5. **Include locale in URLs for SEO** — `/en/about`, not query params
6. **Set `hreflang` tags** — for all alternate language versions
7. **Translate metadata** — titles, descriptions, OG tags

---

## Checklist

- [ ] All user-facing strings use translation keys
- [ ] French translation added (source of truth)
- [ ] English translation added
- [ ] No string concatenation — use interpolation `{variable}`
- [ ] Metadata translated (title, description, OG tags)
